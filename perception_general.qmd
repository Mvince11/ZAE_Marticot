---
title: ""
# format:
#   dashboard:
#     orientation: rows
# editor: visual
# expandable: true
# layout: "grid"
# scrolling: true
lang: fr
toc: true
toc-depth: 4
---

```{r setup, include=FALSE}
# Chargement des packages
library(tidyverse)
library(readr)

# Lecture du fichier CSV
donnees <- read_csv("data/results-survey337264.csv", show_col_types = FALSE)%>%
  drop_na(`Date de soumission`)
```

## 3. PERCEPTION GÉNÉRALE DE LA ZONE D’ACTIVITÉ DE MARTICOT 

```{=html}
<div style="display: flex; align-items: flex-start; gap: 20px;">
  <div style="flex: 1;">
    <p style="text-align: justify;">
La perception qu’ont les salariés de cette zone d’activité offre un éclairage essentiel sur son fonctionnement quotidien, sa qualité d’aménagement et son attractivité en tant que lieu de travail. Au-delà des données économiques, il s’agit ici de comprendre comment la zone est vécue par ceux qui la pratiquent chaque jour : comment ils perçoivent ses qualités, ses manques, et les conditions qu’elle offre en matière de confort, d’accessibilité, de services ou d’ambiance. Notre objectif est de dresser un portrait sur les qualités de la zone mais aussi sur ces points faibles afin de cibler des axes d’améliorations mais surtout de comprendre la perception globale des salariés.
    </p>
  </div>
    <div style="flex: 0 0 370px;">
      <img src="images/panneau_zae.png" alt="Vue de la zone" style="width: 100%; border-radius: 6px;">
    </div>
</div>
```

### 3.1 Dans quelle mesure les salariés trouvent la zone d’activité de Marticot ?  

```{r}
#| include: false

library(dplyr)
library(tidyr)
library(ggplot2)
library(plotly)

# On sélectionne uniquement les colonnes qui t'intéressent
df_notes <- donnees %>%
  select(
    Attractive = `Dans quelle mesure trouvez-vous la zone d’activité de Marticot :Donnez une note de 1 à 6, 1 correspondant à « pas du tout » et 6 « tout à fait » [Attractive]`,
    Conviviale = `Dans quelle mesure trouvez-vous la zone d’activité de Marticot :Donnez une note de 1 à 6, 1 correspondant à « pas du tout » et 6 « tout à fait » [Conviviale]`,
    "Accessible en transport" = `Dans quelle mesure trouvez-vous la zone d’activité de Marticot :Donnez une note de 1 à 6, 1 correspondant à « pas du tout » et 6 « tout à fait » [Accessible en transports]`,
    Isolee = `Dans quelle mesure trouvez-vous la zone d’activité de Marticot :Donnez une note de 1 à 6, 1 correspondant à « pas du tout » et 6 « tout à fait » [Isolée]`,
    Obsolete = `Dans quelle mesure trouvez-vous la zone d’activité de Marticot :Donnez une note de 1 à 6, 1 correspondant à « pas du tout » et 6 « tout à fait » [Obsolète]`
  ) %>%
  pivot_longer(cols = everything(), names_to = "Critere", values_to = "Note") %>%
  filter(!is.na(Note))   # supprimer les NA

# Compter le nombre de réponses par critère et par note
df_plot <- df_notes %>%
  group_by(Critere, Note) %>%
  summarise(N = n(), .groups = "drop")

# S'assurer que Note est un facteur ordonné
df_plot$Note <- factor(df_plot$Note, levels = as.character(1:6))

# Palette de couleurs similaire à RdYlGn
couleurs <- RColorBrewer::brewer.pal(6, "RdYlGn")
```

::: {style="margin-top:30px;"}

```{r}
#| echo: false


# Graphique interactif à barres empilées
plot_ly(
  data = df_plot,
  x = ~Critere,
  y = ~N,
  color = ~Note,
  colors = couleurs,
  type = "bar",
  hovertext = ~paste("Critère :", Critere, "<br>Note :", Note, "<br>Réponses :", N),
  hoverinfo = "text"  # uniquement dans l'infobulle
) %>%
layout(
  barmode = "stack",
  title = list(
    text = "Perception de la zone d’activité de Marticot",
    x = 0.5,
    font = list(color = "red", size = 14)
  ),
  xaxis = list(title = "", tickangle = -30),
  yaxis = list(title = "Nombre de réponses"),
  legend = list(title = list(text = "Note")),
  margin = list(t = 60, b = 80)
) %>%
config(responsive = TRUE)
```
:::

Sous forme de tableau, les répondants devaient donner une note d’appréciation de 1 à 6 sur différent adjectif qualificatif de la zone. L’objectif est de faire ressortir les caractéristiques globales pour mieux identifier les points faibles. 

Les résultats montrent que la zone est perçue de manière nuancée. Elle est jugée moyennement attractive (moyenne 3,15/6) avec un écart-type de 1,24, ce qui traduit une dispersion modérée des réponses. Pour la convivialité on retrouve une moyenne plus basse de (2,92/6) avec 69,4% des répondants ayant donné une note entre 1 et 3. L’accessibilité est la modalité la moins bien évaluée avec une tendance négative (2,37/6) en moyenne, confirmant un ressenti de difficulté d’accès. À l’inverse, l’isolement est plutôt marqué (3,61/6), ce qui traduit une impression de coupure vis-à-vis de son environnement urbain. Cependant l’écart type de 1,64 (le plus élévé des 5) indique tout de même une importante dispersion. Avec 20,9% pour une note de 3 et 21,8% pour une note de 5. Cela peut traduire un isolement à relativiser. Enfin, la zone n’est pas jugée particulièrement obsolète (2,93/6), avec 71,9% des répondants ayant donné une note entre 1 et 3. 
Ces résultats traduisent une image mitigée de la zone de Marticot : si elle conserve une certaine attractivité économique, son manque de convivialité et surtout ses problèmes d’accessibilité apparaissent comme des points faibles majeurs. Le ressenti d’isolement dispersé renforce l’idée d’une zone fonctionnelle mais avec peut-être des problématiques d’intégration à son territoire.


### 3.2 Ressentez-vous des nuisances dans la ZAE de Marticot ?

Sur la question des nuisances, nous avons voulus savoir quels pourrez être les éléments pouvant rendre l’expérience négative dans le zone, ainsi impacter le quotidien des salariés. Sur l’ensemble des répondants, on retrouve une majorité de personnes ne trouvant pas que la zone d’activité de Marticot soit associés à une quelconque nuisance (71,4%). Cependant 27,7% soit presque 1/3 estiment ressentir des nuisances.

```{r}
#| echo: false
library(plotly)

# Préparation des données
df_nuisances <- donnees %>%
  count(Reponse = `Ressentez-vous des nuisances dans la zone d’activité de Marticot ?`) %>%
  mutate(
    Reponse = case_when(
      is.na(Reponse) | Reponse == "N/A" ~ "Sans réponse",
      TRUE ~ Reponse
    ),
    Total = sum(n),
    Pourcent = round(100 * n / Total, 1),
    label = paste0(Reponse, " (", Pourcent, "%)")
  )

# Graphique circulaire interactif
plot_ly(
  data = df_nuisances,
  labels = ~Reponse,
  values = ~n,
  type = "pie",
  hole= 0.4,
  #textinfo = "label+percent+value",
  hoverinfo = "label+value+percent",
  marker = list(line = list(color = "#FFFFFF", width = 1))
) %>%
  layout(
    title = list(
      text = "Ressentez-vous des nuisances",
      x = 0.5,
      font = list(color = "red", size = 14)
    ),
    margin = list(t = 60, b = 60)
  ) %>%
  config(responsive = TRUE)
```

Dans l’élaboration de notre questionnaire, nous avons prédéfinis des catégories qui nous semblaient pertinentes et englobantes ; Les nuisances liées : 

- À l’environnement bruyant 
- À la circulation de poids lourd
- Au trafic routier et à la sécurité 
- Aux odeurs
- À l’accessibilité 
- Les nuisances 

A savoir que les 3 dernières catégories ont étés rajoutés après avoir analyser les réponses libres des personnes ayant choisis de préciser dans « autre ». 


```{r}
#| echo: false

library(dplyr)
library(tidyr)
library(ggplot2)
library(plotly)

# On sélectionne uniquement les colonnes qui t'intéressent
nuisances_notes <- donnees %>%
  select(
    Bruit = `Si oui, lesquelles ?  Veuillez cocher une ou plusieurs réponse  [Bruit]`,
    "Circulation poids lourds"= `Si oui, lesquelles ?  Veuillez cocher une ou plusieurs réponse  [Circulation de poids lourds]`,
    "Trafic routier" = `Si oui, lesquelles ?  Veuillez cocher une ou plusieurs réponse  [Trafic routier]`,
    Odeurs = `Si oui, lesquelles ?  Veuillez cocher une ou plusieurs réponse  [Odeurs]`
  ) %>%
  pivot_longer(cols = everything(), names_to = "Critere", values_to = "Note") %>%
  mutate(
    Note = case_when(
      is.na(Note) | Note == "N/A" ~ "Sans réponse",
      Note %in% c("Non", "FALSE") ~ "Non",
      Note %in% c("Oui", "TRUE") ~ "Oui",
      TRUE ~ as.character(Note)
    )
  )

df_nuis <- nuisances_notes %>%
  group_by(Critere, Note) %>%
  summarise(N = n(), .groups = "drop")

p2 <- ggplot(df_nuis, aes(
    x = Critere, y = N, fill = factor(Note),
    text = paste(
      "Critère :", Critere,
      "<br>Réponse :", Note,
      "<br>Nombre de réponses :", N
    )
  )) +
  geom_bar(stat = "identity", position = "stack") +
  scale_fill_brewer(palette = "RdYlGn", direction = 1) +
  labs(
    title = "Origines des nuisances",
    x = "", y = "Nombre de réponses", fill = "Note"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(color = "red", size = 10, face = "bold", hjust = 0.5),
    axis.text.x = element_text(hjust = 0.5, size = 7),
    axis.title.y = element_text(size = 8),
    axis.text.y = element_text(size = 7),
    legend.text = element_text(size = 7),
    legend.title = element_text(size = 7),
    legend.key.size = unit(0.8, "cm"),
    legend.spacing.y = unit(0.1, "cm")
  )

ggplotly(p2, tooltip = "text") 
  
```


Les résultats mettent en évidence une perception différenciée des nuisances parmi les salariés interrogés. Trois types de nuisances ressortent nettement :

- le trafic et la sécurité, cités par plus des trois quarts des répondants (77,8 %) ;
- le bruit, mentionné par 60,0 % ;
- et la circulation des poids lourds, évoquée par 53,3 %.

Ces résultats traduisent une sensibilité forte des usagers à la circulation routière et à ses conséquences directes, qu’il s’agisse du bruit, du trafic dense ou des poids lourds.
À l’inverse, l’odeur, l’accessibilité et la pollution apparaissent comme beaucoup plus marginales comme nuisances. Mais celles-ci ont étés rajoutés à partir de la case autre qui permettaient de préciser d’autres nuisances non cités. 
Ainsi, les nuisances perçues dans la zone d’activité sont avant tout liées aux conditions de circulation et de sécurité, tandis que les nuisances environnementales plus classiques (pollution de l’air, odeurs) sont relativement peu mentionnées.


### 3.3 Selon vous la zone d’activité de Marticot est caractérisée par : 

::: {style="margin-top:30px;"}
```{r}
#| echo: false
#| fig.width: 4
#| fig.height: 3

library(dplyr)
library(tidyr)
library(ggplot2)
library(plotly)

# Préparation des données
caracterisation_notes <- donnees %>%
  select(
    "Ses espaces de convivialité" = `Selon vous, la zone d’activité de Marticot est caractérisée par :Donnez une note en cochant de 1 à 6, 1 correspondant à « pas du tout » et 6 « tout à fait » [Ses espaces de convivialité]`,
    "Ses services"= `Selon vous, la zone d’activité de Marticot est caractérisée par :Donnez une note en cochant de 1 à 6, 1 correspondant à « pas du tout » et 6 « tout à fait » [Ses services (équipements sportifs, restauration, supermarchés…)]`,
    "Sa propreté et son bon entretien" = `Selon vous, la zone d’activité de Marticot est caractérisée par :Donnez une note en cochant de 1 à 6, 1 correspondant à « pas du tout » et 6 « tout à fait » [Sa propreté et son bon entretien]`,
    "La sécurité" = `Selon vous, la zone d’activité de Marticot est caractérisée par :Donnez une note en cochant de 1 à 6, 1 correspondant à « pas du tout » et 6 « tout à fait » [La sécurité (de ses biens et des personnes)]`,
    "Ses cheminements piétons" = `Selon vous, la zone d’activité de Marticot est caractérisée par :Donnez une note en cochant de 1 à 6, 1 correspondant à « pas du tout » et 6 « tout à fait » [Ses cheminements piétons]`,
    "Son réseau internet" = `Selon vous, la zone d’activité de Marticot est caractérisée par :Donnez une note en cochant de 1 à 6, 1 correspondant à « pas du tout » et 6 « tout à fait » [Son réseau internet]`,
    "Ses espaces verts" = `Selon vous, la zone d’activité de Marticot est caractérisée par :Donnez une note en cochant de 1 à 6, 1 correspondant à « pas du tout » et 6 « tout à fait » [Ses espaces verts]`
  ) %>%
  pivot_longer(cols = everything(), names_to = "Critere", values_to = "Note") %>%
  filter(!is.na(Note))%>%
  mutate(Note = factor(
    Note,
    levels = 1:6,
    labels = c("1 = Pas du tout", "2", "3", "4", "5", "6 = Tout à fait")
  ))

# Comptage des réponses par critère/note
df_plot <- caracterisation_notes %>%
  group_by(Critere, Note) %>%
  summarise(N = n(), .groups = "drop")%>%
  group_by(Critere) %>%
  mutate(
    Total = sum(N),
    Pourcent = round(100 * N / Total, 1)  # % arrondi à 1 décimale
  )

plot_ly(
  data = df_plot,
  x = ~Critere,
  y = ~N,
  color = ~Note,
  colors = "RdYlGn",
  type = "bar",
  text = ~paste(
    "Critère :", Critere,
    "<br>Note :", Note,
    "<br>Réponses :", N,
    "<br>Pourcentage :", Pourcent, "%"
  ),
  hoverinfo = "text",
  textposition = "none"
) %>%
  layout(
    barmode = "stack",
    title = list(
      text = "Selon vous, la zone d’activité de Marticot est caractérisée par",
      x = 0.5,
      font = list(color = "red", size = 14)
    ),
    xaxis = list(title = "", tickangle = 20),
    yaxis = list(title = "Nombre de réponses"),
    legend = list(
      title = list(text = "Note"),
      orientation = "h",   # légende horizontale
      x = 0.5,             # centrée
      y = -0.35,            # sous le graphique
      xanchor = "center"   # ancrage centré
    ),
    autosize = TRUE
  ) %>%
  config(responsive = TRUE)


```
:::

L’analyse des réponses montre une perception contrastée des différentes dimensions de la zone d’activité. Les salariés jugent positivement la qualité du réseau et la présence d’espaces verts, qui recueillent les meilleures moyennes (respectivement 4,23 et 4,17 sur 6). La majorité des répondants s’accorde à reconnaître ces atouts, même si l’écart-type un peu plus élevé pour les espaces verts laisse apparaître des avis plus dispersés selon les secteurs ou les usages.  

La sécurité et la propreté sont évaluées de manière correcte, autour de 3,8 en moyenne. Ces résultats traduisent une appréciation globalement satisfaisante, (61,4% des notes allant de 4 à 6 pour la sécurité et 61,2%  pour la propreté) mais il faut tout de même nuancer : certains salariés estiment ces dimensions convenables, quand d’autres expriment des réserves, ce que confirme la dispersion modérée des réponses.  

En revanche, d’autres critères apparaissent beaucoup plus faibles. Les cheminements obtiennent une moyenne de 3,08, ce qui traduit une appréciation mitigée et assez hétérogène : les salariés sont partagés entre une relative fonctionnalité et des insuffisances perçues. Plus marquant encore, la convivialité (2,31) et la présence de services (2,38) ressortent comme les points les plus déficitaires. Les réponses sont ici fortement concentrées dans les modalités basses, ce qui montre un consensus autour d’un manque d’espaces favorisant d’une certaine manière la sociabilité et l’interaction grâce à des équipements de proximité dans la zone.  

En résumé, si la ZA de Marticot est reconnue pour ses atouts en termes d’infrastructures et de cadre paysager, elle souffre d’un déficit marqué en services et en convivialité. La sécurité et la propreté sont jugées acceptables mais non pleinement satisfaisantes, et les cheminements apparaissent comme un élément à appronfondir/ valoriser. Cette lecture croisée des moyennes, des fréquences et de la dispersion des réponses met donc en lumière une zone perçue comme fonctionnelle et structurée, mais insuffisamment pensée pour le quotidien et la sociabilité des salariés.

![](images/bus_marticot.png){fig-align="center" width=60%}

### 3.4 Dans quelle mesure trouvez-vous la zone d’activité de Marticot ? 

```{r}
#| echo: false

library(dplyr)
library(tidyr)
library(ggplot2)

# On sélectionne uniquement les colonnes qui t'intéressent
aspect_notes <- donnees %>%
  select(
    `Dans quelle mesure trouvez-vous la zone d’activité de Marticot :  Donnez une note de 1 à 6, 1 correspondant à « moche » et 6 « esthétique »  [Votre choix]` 
  ) %>%
  pivot_longer(cols = everything(), names_to = "Critere", values_to = "Note") %>%
  filter(!is.na(Note))   # supprimer les NA

# Compter le nombre de réponses par critère et par note
df_plot <- aspect_notes %>%
  group_by(Critere, Note) %>%
  summarise(N = n(), .groups = "drop")%>%
  mutate(Critere = " ")

# Graphique : barres empilées
ggplot(df_plot, aes(x = Critere, y = N, fill = factor(Note))) +
  geom_bar(stat = "identity", position = "stack") +
  scale_fill_brewer(palette = "RdYlGn", direction = 1,
                     labels = c(
                      "1 = Moche",
                      "2",
                      "3",
                      "4",
                      "5",
                      "6 = Esthétique"
                      )
                    ) +
  geom_text(aes(label = N), 
            position = position_stack(vjust = 0.5), 
            color = "black", size = 1) +
  labs(
    title = "Aspect visuel",
    x = NULL,
    y = "Nombre de réponses",
    fill = "Note"
  ) +
  theme_minimal() +
  theme(plot.title = element_text(color = "red", size = 4, face = "bold", hjust = 0.5),
        axis.text.x = element_text( hjust = 0.5, size = 4),
        axis.title.x = element_blank(),  # Titre axe X
        axis.title.y = element_text(size = 4),  # Titre axe Y
        axis.text.y = element_text(size = 4),     # Valeurs axe Y
        legend.text = element_text(size = 3),        # Taille du texte de la légende
        legend.title = element_text(size = 4),        # Taille du titre de la légende
        legend.key.size = unit(0.3, "cm"),        # Taille des cases de la légende
        legend.spacing.y = unit(0.1, "cm")        # Espacement vertical réduit
        )
```

```{r}
#| echo: false
#| fig.width: 4
#| fig.height: 2

library(dplyr)
library(tidyr)
library(ggplot2)

# On sélectionne uniquement les colonnes qui t'intéressent
espaces_verts_notes <- donnees %>%
  select(
    `Dans quelle mesure êtes-vous attaché(e) aux espaces verts présents sur la zone d’activités de Marticot ?  Donnez une note de 1 à 6, 1 correspondant à « pas du tout attaché » et 6 « très attaché »  [Votre choix]` 
  ) %>%
  pivot_longer(cols = everything(), names_to = "Critere", values_to = "Note") %>%
  filter(!is.na(Note))   # supprimer les NA

# Compter le nombre de réponses par critère et par note
df_plot <- espaces_verts_notes %>%
  group_by(Critere, Note) %>%
  summarise(N = n(), .groups = "drop")%>%
  mutate(Critere = " ")

# Graphique : barres empilées
ggplot(df_plot, aes(x = Critere, y = N, fill = factor(Note))) +
  geom_bar(stat = "identity", position = "stack") +
  scale_fill_brewer(palette = "RdYlGn", direction = 1,
                     labels = c(
                      "1 = pas du tout",
                      "2",
                      "3",
                      "4",
                      "5",
                      "6 = tout à fait"
                      )
                    ) +
  geom_text(aes(label = N), 
            position = position_stack(vjust = 0.5), 
            color = "black", size = 1) +
  labs(
    title = "Etes-vous attaché(e) aux espaces verts présents sur la zone d’activités de Marticot ?",
    x = NULL,
    y = "Nombre de réponses",
    fill = "Note"
  ) +
  theme_minimal() +
  theme(plot.title = element_text(color = "red", size = 4, face = "bold", hjust = 0.5),
        axis.text.x = element_text( hjust = 0.5, size = 4),
        axis.title.x = element_blank(),  # Titre axe X
        axis.title.y = element_text(size = 4),  # Titre axe Y
        axis.text.y = element_text(size = 4),     # Valeurs axe Y
        legend.text = element_text(size = 3),        # Taille du texte de la légende
        legend.title = element_text(size = 4),        # Taille du titre de la légende
        legend.key.size = unit(0.3, "cm"),        # Taille des cases de la légende
        legend.spacing.y = unit(0.1, "cm")        # Espacement vertical réduit
        )
```

## Row {height="30%"}

```{r}
#| echo: false
#| fig.width: 4
#| fig.height: 2

library(dplyr)
library(tidyr)
library(ggplot2)

# On sélectionne uniquement les colonnes qui t'intéressent
batiments_notes <- donnees %>%
  select(
    `Comment jugez-vous l’état général des bâtiments de la zone d’activité de Marticot ?Donnez une note en cochant de 1 à 6, 1 correspondant à « très mauvais » et 6 « très bon » [Votre choix]`
  ) %>%
  pivot_longer(cols = everything(), names_to = "Critere", values_to = "Note") %>%
  filter(!is.na(Note))   # supprimer les NA

# Compter le nombre de réponses par critère et par note
df_plot <- batiments_notes %>%
  group_by(Critere, Note) %>%
  summarise(N = n(), .groups = "drop")%>%
  mutate(Critere = " ")

# Graphique : barres empilées
ggplot(df_plot, aes(x = Critere, y = N, fill = factor(Note))) +
  geom_bar(stat = "identity", position = "stack") +
  scale_fill_brewer(palette = "Dark2", direction = 1,
                     labels = c(
                      "1 = très mauvais",
                      "2",
                      "3",
                      "4",
                      "5",
                      "6 = très bon"
                      )
                    ) +
  geom_text(aes(label = N), 
            position = position_stack(vjust = 0.5), 
            color = "black", size = 1) +
  labs(
    title = "Comment jugez-vous l’état général des bâtiments ?",
    x = NULL,
    y = "Nombre de réponses",
    fill = "Note"
  ) +
  theme_minimal() +
  theme(plot.title = element_text(color = "red", size = 4, face = "bold", hjust = 0.5),
        axis.text.x = element_text( hjust = 0.5, size = 4),
        axis.title.x = element_blank(),  # Titre axe X
        axis.title.y = element_text(size = 4),  # Titre axe Y
        axis.text.y = element_text(size = 4),     # Valeurs axe Y
        legend.text = element_text(size = 3),        # Taille du texte de la légende
        legend.title = element_text(size = 4),        # Taille du titre de la légende
        legend.key.size = unit(0.3, "cm"),        # Taille des cases de la légende
        legend.spacing.y = unit(0.1, "cm")        # Espacement vertical réduit
        )
```

```{r}
#| echo: false
#| fig.width: 4
#| fig.height: 2

library(dplyr)
library(tidyr)
library(ggplot2)

# On sélectionne uniquement les colonnes qui t'intéressent
friches_notes <- donnees %>%
  select(
    `Avez-vous remarqué la présence de friches (terrain ou local abandonnés de longue date) ou de locaux vacants sur la zone d’activité de Marticot?  Veuillez choisir une seule réponse`
  ) %>%
  pivot_longer(cols = everything(), names_to = "Critere", values_to = "Note") %>%
  filter(!is.na(Note))   # supprimer les NA

# Compter le nombre de réponses par critère et par note
df_plot <- friches_notes %>%
  group_by(Critere, Note) %>%
  summarise(N = n(), .groups = "drop")%>%
  mutate(Critere = " ")

# Graphique : barres empilées
ggplot(df_plot, aes(x = Critere, y = N, fill = factor(Note))) +
  geom_bar(stat = "identity", position = "stack") +
  scale_fill_brewer(palette = "Set2", direction = 1) +
  geom_text(aes(label = N), 
            position = position_stack(vjust = 0.5), 
            color = "black", size = 1) +
  labs(
    title = "Présence de friches ou de locaux vacants ?",
    x = NULL,
    y = "Nombre de réponses",
    fill = "Note"
  ) +
  theme_minimal() +
  theme(plot.title = element_text(color = "red", size = 4, face = "bold", hjust = 0.5),
        axis.text.x = element_text( hjust = 0.5, size = 4),
        axis.title.x = element_blank(),  # Titre axe X
        axis.title.y = element_text(size = 4),  # Titre axe Y
        axis.text.y = element_text(size = 4),     # Valeurs axe Y
        legend.text = element_text(size = 3),        # Taille du texte de la légende
        legend.title = element_text(size = 4),        # Taille du titre de la légende
        legend.key.size = unit(0.3, "cm"),        # Taille des cases de la légende
        legend.spacing.y = unit(0.1, "cm")        # Espacement vertical réduit
        )
```

## Row {height="30%"}

```{r}
#| echo: false
#| fig.width: 4
#| fig.height: 2

library(dplyr)
library(tidyr)
library(ggplot2)
#library(plotly)

# On sélectionne uniquement les colonnes qui t'intéressent
caracterisation_notes <- donnees %>%
  select(
    "Plus verte" = `Si la zone d’activité de Marticot devait évoluer (attention il n’y a aucun projet prévu, cette question vise uniquement à comprendre comment des salariés se projetteraient vers une éventuelle évolution), pour vous elle devrait être :1 correspondant à « pas du tout » et 6 « tout à fait » [Plus verte]`,
    "Plus accessible"= `Si la zone d’activité de Marticot devait évoluer (attention il n’y a aucun projet prévu, cette question vise uniquement à comprendre comment des salariés se projetteraient vers une éventuelle évolution), pour vous elle devrait être :1 correspondant à « pas du tout » et 6 « tout à fait » [Plus accessible]`,
    "Plus dense" = `Si la zone d’activité de Marticot devait évoluer (attention il n’y a aucun projet prévu, cette question vise uniquement à comprendre comment des salariés se projetteraient vers une éventuelle évolution), pour vous elle devrait être :1 correspondant à « pas du tout » et 6 « tout à fait » [Plus dense]`,
    "Plus accessible à pied" = `Si la zone d’activité de Marticot devait évoluer (attention il n’y a aucun projet prévu, cette question vise uniquement à comprendre comment des salariés se projetteraient vers une éventuelle évolution), pour vous elle devrait être :1 correspondant à « pas du tout » et 6 « tout à fait » [Plus accessible à pied]`,
    "Mieux desservie" = `Si la zone d’activité de Marticot devait évoluer (attention il n’y a aucun projet prévu, cette question vise uniquement à comprendre comment des salariés se projetteraient vers une éventuelle évolution), pour vous elle devrait être :1 correspondant à « pas du tout » et 6 « tout à fait » [Mieux desservie]`,
    "Accueillir des services qui seraient utiles à tous" = `Si la zone d’activité de Marticot devait évoluer (attention il n’y a aucun projet prévu, cette question vise uniquement à comprendre comment des salariés se projetteraient vers une éventuelle évolution), pour vous elle devrait être :1 correspondant à « pas du tout » et 6 « tout à fait » [Accueillir des services qui  seraient utiles à tous]`,
    "Accueillir des services qui vous seraient utiles à vous" = `Si la zone d’activité de Marticot devait évoluer (attention il n’y a aucun projet prévu, cette question vise uniquement à comprendre comment des salariés se projetteraient vers une éventuelle évolution), pour vous elle devrait être :1 correspondant à « pas du tout » et 6 « tout à fait » [Accueillir des services qui vous seraient utiles à vous]`
    
    
  ) %>%
  pivot_longer(cols = everything(), names_to = "Critere", values_to = "Note") %>%
  filter(!is.na(Note))   # supprimer les NA

# Compter le nombre de réponses par critère et par note
df_plot <- caracterisation_notes %>%
  group_by(Critere, Note) %>%
  summarise(N = n(), .groups = "drop")

# Graphique : barres empilées
ggplot(df_plot, aes(x = Critere, y = N, fill = factor(Note))) +
  geom_bar(stat = "identity", position = "stack") +
  scale_fill_brewer(palette = "RdYlGn", direction = 1) +
  geom_text(aes(label = N), 
            position = position_stack(vjust = 0.5), 
            color = "black", size = 1) +
  labs(
    title = "Selon vous, la zone d’activité de Marticot est caractérisée par",
    x = "",
    y = "Nombre de réponses",
    fill = "Note"
  ) +
  theme_minimal() +
  theme(plot.title = element_text(color = "red", size = 4, face = "bold", hjust = 0.5),
        axis.text.x = element_text( hjust = 0.5, size = 4, angle = 20),
        axis.title.x = element_text(size = 2),  # Titre axe X
        axis.title.y = element_text(size = 4),  # Titre axe Y
        axis.text.y = element_text(size = 4),     # Valeurs axe Y
        legend.text = element_text(size = 3),        # Taille du texte de la légende
        legend.title = element_text(size = 4),        # Taille du titre de la légende
        legend.key.size = unit(0.3, "cm"),        # Taille des cases de la légende
        legend.spacing.y = unit(0.1, "cm")        # Espacement vertical réduit
        )

```

```{r}
#| echo: false
#| fig.width: 4
#| fig.height: 2

library(dplyr)
library(tidyr)
library(ggplot2)
library(plotly)

# Colonnes des services
services_avis <- donnees %>%
  select(
    "Restauration" = `Quels services vous seraient utiles :Veuillez cocher une ou plusieurs réponses [Restauration]`,
    "Équipements sportifs" = `Quels services vous seraient utiles :Veuillez cocher une ou plusieurs réponses [Équipements sportifs]`,
    "Pôle médical ou para-médical" = `Quels services vous seraient utiles :Veuillez cocher une ou plusieurs réponses [Pôle médical ou para-médical]`,
    "Services à la personne" = `Quels services vous seraient utiles :Veuillez cocher une ou plusieurs réponses [Services à la personne (coiffeur, institut de beauté, pressing...)]`,
    "Supermarchés" = `Quels services vous seraient utiles :Veuillez cocher une ou plusieurs réponses [Supermarchés]`,
    "Système de garde d’enfants collectif" = `Quels services vous seraient utiles :Veuillez cocher une ou plusieurs réponses [Système de garde d’enfants collectif]`
  ) %>%
  pivot_longer(cols = everything(), names_to = "Service", values_to = "Reponse")

# Comptage uniquement des "Oui"
df_plot <- services_avis %>%
  filter(Reponse == "Oui") %>%
  group_by(Service) %>%
  summarise(N = n(), .groups = "drop")

# Graphique ggplot
p <- ggplot(df_plot, aes(x = reorder(Service, N), y = N, fill = Service,
                         text = paste("Service:", Service, "<br>Réponses:", N))) +
  geom_col(show.legend = FALSE) +   # enlève la légende
  labs(
    title = "Quels services vous seraient utiles",
    x = "",
    y = "Nombre de personnes"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(color = "red", size = 10, face = "bold", hjust = 0.5),
    axis.text.x = element_text(angle = 25, hjust = 1, size = 8),
    axis.title.x = element_blank(),
    axis.title.y = element_text(size = 9),
    axis.text.y = element_text(size = 8),
    legend.position = "none"   # supprime totalement la légende
  )

# Graphique interactif
ggplotly(p, tooltip = "text")
```
